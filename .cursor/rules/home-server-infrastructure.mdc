---
description: 
globs: 
alwaysApply: true
---
# Home Server Kubernetes Setup

## Infrastructure Overview
- MicroK8s cluster running on home server
- Traefik ingress controller with dual port configuration:
  - Admin port: 8080 (dashboard)
  - Public port: 9080 (services)
- All services accessible via `home.server` hostname
- No TLS/HTTPS for local development
- Tailscale VPN for remote access

## Namespaces and Services
1. kube-system:
   - Traefik ingress controller
   - Dashboard path: /dashboard/

2. shared:
   - Redis:
     - Internal: redis.shared.svc.cluster.local:6379
     - External: home.server:6379
     - Used for: Caching, sessions
     - Authentication required (password protected)
   - PostgreSQL:
     - Internal: postgres.shared.svc.cluster.local:5432
     - External: home.server:5432
     - Database: web_crawler
     - User: admin
     - Authentication required (password protected)

3. argocd:
   - Version: 2.8.4
   - Path: /argocd
   - Components: Server, Application Controller, Repo Server
   - Uses shared Redis for caching

4. default:
   - Ollama LLM service
   - Path: /ollama
   - Models: llama3 (8B)

## Access Patterns
- All HTTP services: http://home.server/<service-path>
- Database services: Direct port access on home.server
- Timeout requirement: 20 seconds for all external requests
- Authentication: Pre-configured on development machine

## Security Context
- Secrets managed via k8s/secrets/
- Base64 encoded secret values
- No TLS in local development
- Secrets generated via generate-secrets.sh
- Latest Traefik configurations enforced

## Directory Structure
```
k8s/
├── argocd/         # ArgoCD deployment configs
├── shared/         # Shared infrastructure components
│   ├── namespace.yaml
│   ├── redis/      # Redis service configs
│   ├── postgres/   # PostgreSQL configs
│   └── kustomization.yaml
├── ollama/         # Ollama service configs
├── secrets/        # Secret management
├── traefik/        # Ingress controller
├── web_crawler/    # Web crawler service
└── kustomization.yaml
```

## Best Practices
1. Use kubectl for cluster interactions
2. Add timeouts to all external requests
3. Follow secrets management guidelines
4. Use latest Traefik features
5. Reference services by cluster DNS names 